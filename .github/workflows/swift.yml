name: NetaVPN iOS Build

on: push: branches: [ "main" ] pull_request: branches: [ "main" ]

jobs: build_ios: runs-on: macos-latest steps: - uses: actions/checkout@v4


# Flutter 설치 (필요 버전)
- uses: subosito/flutter-action@v2
  with:
    flutter-version: '3.13.0'
    channel: 'stable'
    cache: true

- name: Check Flutter & Dart
  run: flutter --version

- name: Install Flutter deps
  run: flutter pub get

- name: Install CocoaPods
  run: gem install cocoapods

- name: Prepare iOS pods
  run: |
    cd ios
    if [ ! -f Podfile ]; then
      flutter pub get
      flutter build ios --no-codesign
    fi
    pod install --repo-update
    cd ..

# 빌드: flutter build ipa 권장(서명 설정 필요 시 옵션 추가)
- name: Build IPA (flutter build ipa)
  env:
    FLUTTER_BUILD_MODE: release
  run: |
    flutter build ipa --export-options-plist=ios/ExportOptions.plist --no-codesign

- name: Upload IPA
  uses: actions/upload-artifact@v4
  with:
    name: ipa
    path: build/ios/ipa
